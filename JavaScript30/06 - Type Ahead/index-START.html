<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Type Ahead ðŸ‘€</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
    </ul>
</form>
<script>
    const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

    const cities = [];

    // const prom = fetch(endpoint);
    // console.log(prom)

    // Fetch APIëŠ” ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í¬í•¨í•œ ë¦¬ì†ŒìŠ¤ ì·¨ë“ì„ ìœ„í•œ ì¸í„°íŽ˜ì´ìŠ¤ê°€ ì •ì˜ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
    // XMLHttpRequestì™€ ê°™ì€ ë¹„ìŠ·í•œ APIê°€ ì¡´ìž¬í•©ë‹ˆë‹¤ë§Œ, ìƒˆë¡œìš´ Fetch APIëŠ” ì¢€ë” ê°•ë ¥í•˜ê³  ìœ ì—°í•œ ì¡°ìž‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.


    // fetch(endpoint).then(blob => console.log(blob));
    fetch(endpoint)
        .then(blob => blob.json())
        // .then(data => console.log(data))
        .then(data => cities.push(...data));

    function findMatches(wordToMatch, cities) {
        return cities.filter(place => {
            // ì—¬ê¸°ì„œ ìš°ë¦¬ëŠ” ë„ì‹œ ë‚˜ êµ­ê°€ê°€ ê²€ìƒ‰ëœ ê²ƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ì•Œì•„ ë‚´ì•¼í•©ë‹ˆë‹¤.

            // https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/RegExp
            // new RegExp(pattern[, flags])  : ìƒì„±ìžë¡œ ë§Œë“¤ë•Œ
            // g : global match; ì¼ì¹˜í•˜ëŠ” ì²« ë²ˆì§¸ ë¬¸ìžì—ì„œ ë©ˆì¶”ì§€ ì•Šê³  ì „ì²´ì—ì„œ ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ë¬¸ìžë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.
            // i : ignore case(ëŒ€ì†Œë¬¸ìžë¥¼ êµ¬ë³„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.)
            // m : multiline; ì‹œìž‘ í˜¹ì€ ë ë¬¸ìž íƒìƒ‰(^ and $)ì´ ë‹¤ì¤‘í–‰ì— ì ìš©ë˜ë„ë¡ í•©ë‹ˆë‹¤.
            // (ì˜ˆë¡œ,  \n í˜¹ì€ \rë¡œ ê°œí–‰ëœ ê°ê°ì˜ ë¼ì¸ ì‹œìž‘ í˜¹ì€ ë ë¿ë§Œ ì•„ë‹ˆë¼, ì „ì²´ ìž…ë ¥ ë¬¸ìžì˜ ì‹œìž‘ í˜¹ì€ ëì—ì„œ ì¼ì¹˜í•©ë‹ˆë‹¤.
            // y : ëŒ€ìƒ ë¬¸ìžì—´ì—ìžˆëŠ”ì´ ì •ê·œ í‘œí˜„ì‹ì˜ lastIndex ì†ì„±ì— ì˜í•´ ì§€ì •ëœ ì¸ë±ìŠ¤ì—ì„œë§Œ ì¼ì¹˜í•˜ë©° ì´í›„ì˜ ëª¨ë“  ì¸ë±ìŠ¤ì—ì„œ ì¼ì¹˜ ì‹œí‚¤ë ¤ê³  ì‹œë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

            const regex = new RegExp(wordToMatch, 'gi');
            return place.city.match(regex) || place.state.match(regex)
        });
    }

    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    function displayMatches() {
        // console.log(this.value);
        const matchArray = findMatches(this.value, cities);
        // console.log(matchArray);
        const html = matchArray.map(place => {
            const regex = new RegExp(this.value, 'gi');
            const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
            const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
            return `
            <li>
                <span class="name">${cityName}, ${stateName}</span>
                <span class="population">${numberWithCommas(place.population)}</span>
            </li>
           `;
        }).join('');
        suggestions.innerHTML = html;
    }

    const searchInput = document.querySelector('.search');
    const suggestions = document.querySelector('.suggestions');

    searchInput.addEventListener('change', displayMatches);
    searchInput.addEventListener('keyup', displayMatches);


</script>
</body>
</html>
